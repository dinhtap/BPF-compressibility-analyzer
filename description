The BPF hookpoints are based on BPF_PROG_TYPE_LSM, using BPF_TRAMP_REPLACE. Hookpoints are replaced by attached BPF programs. Due to use of kmalloc (and only kmalloc) in vfs_write, any write on any file to be compressed, that tries to write >= 128 * 1024 bytes or its compressed size >= 128 * 1024, will result to -ENOMEM, but data will still be written to file. The better solution would be use of vmalloc if too much bytes are to be written. 
